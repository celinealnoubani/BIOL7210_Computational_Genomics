# Prodigal Gene Prediction & EggNOG Annotation Results

This repository contains the results of a two-step gene analysis pipeline executed on a high-performance computing cluster. First, genes are predicted using Prodigal, and then the predicted protein sequences are annotated using EggNOG-mapper. This repository includes input data, Prodigal output files, EggNOG result TSVs, log files, the main commands script, and the overall data file structure.

## System Specifications

- **Cluster Environment**: High-Performance Computing Cluster  
- **Modules**: Anaconda 3
- **Node Type**: Compute Nodes  
- **Allocated Cores**: 16  
- **Memory**: 32 GB

## Tools Used

- **Prodigal**: Version 2.6.3  
- **EggNOG-mapper**: Version 2.1.12

## Language Used

- **GNU Bash**: Version 5.0.18
- **Python**: Version 3.8.20 for eggnog_env and prodigal_env

## Important Notes

- The provided pipeline scripts assume that the file structure of this repository matches the layout on the computing cluster. Adjust file paths if files are relocated.
- Performance metrics (runtime, memory usage, and CPU utilization) for both Prodigal and EggNOG-mapper are recorded in log files.
- For large datasets, consider adjusting CPU and memory allocation as annotation requires substantial resources.
- Some results and logs may be compressed (e.g., using gzip) for easier storage and transfer.
- Final annotation files are now available in GFF format with the naming convention `{sample_name}_Prodigal_EggNOG.gff`.
- Special ID format conversion ensures proper integration between Prodigal outputs and EggNOG annotations.

## File Structure

- **`data/`**  
  - **`contigs/`**:  
    Contains filtered contig FASTA files for each sample (compressed .fa.gz format).


- **`results/`**  
  - **`prodigal/`**:  
    Contains output folders for each sample from Prodigal. Each folder includes:  
    - `predicted_proteins.fasta`: Predicted protein sequences in FASTA format.  
    - `predicted_genes.fna`: Nucleotide sequences of predicted genes.
    - `[sample]_prodigal.gff`: GFF annotation file with predicted gene models.  
    - `[sample]_predicted_proteins_clean.faa`: Cleaned protein sequences with modified IDs for EggNOG.
    - Other intermediate files generated by Prodigal.
  - **`eggnog/`**:  
    Contains EggNOG-mapper output folders for each sample. Each folder includes:
    - `[sample].emapper.annotations.tsv`: Tab-separated annotation results.
    - `[sample].emapper.hits`: Diamond search results showing ortholog matches.
    - `[sample].emapper.decorated.gff`: GFF file with EggNOG annotations integrated into Prodigal predictions.
    - Other intermediate files generated by EggNOG-mapper.
  - **`final_annotations/`**:  
    Contains the final GFF and optionally GenBank format files with standardized naming:
    - `[sample]_Prodigal.gff`: Original Prodigal gene predictions.
    - `[sample]_Prodigal_EggNOG.gff`: Combined structural and functional annotations.
  - **`prodigal_mean_cds_length.tsv`**:
    A summary file containing the mean coding sequence length for each sample processed by Prodigal.

- **`logs/`**:  
  Contains log files for each sample documenting runtime, memory usage, and CPU utilization for both Prodigal and EggNOG-mapper:
  - `[sample]_prodigal_time.log`: Performance metrics for Prodigal.
  - `[sample]_eggnog_time.log`: Performance metrics for EggNOG-mapper.

- **`final_report/`**:  
  Contains a consolidated TSV file (`final_metrics.tsv`) that summarizes performance metrics and output statistics for both tools:  
  - For Prodigal, the TSV row includes the sample name, tool ("Prodigal"), memory usage, runtime, CPU usage, CDS count, and "NA" for annotated proteins.  
  - For EggNOG, the TSV row includes the sample name, tool ("EggNOG"), memory usage, runtime, CPU usage, "NA" for CDS count, and the number of annotated proteins.

- **`scratch/`**:  
  - **`eggnog_db/`**:  
    Contains the EggNOG database files required for annotation:
    - `eggnog.db`: Main annotation database.
    - `eggnog_proteins.dmnd`: Diamond sequence database.
    - `eggnog.taxa.db`: Taxonomy database.
    - Other supporting database files.

- **`scripts/`**:
  - `run_pipeline.sh`: Contains the commands used to run the Prodigal and EggNOG workflows (main pipeline script).

- **`README.md`**:  
  This file, which describes the project, system specifications, tools used, and file structure.

## Pipeline Overview

1. **Prodigal**: Uses de novo gene prediction to identify coding sequences in bacterial genomes.
   - Input: Contig FASTA files for each sample
   - Output: Predicted gene models (GFF) and protein sequences (FASTA)
   - Parameters: Meta mode for metagenome/diverse bacterial assemblies

2. **ID Format Conversion**: Prepares protein sequences for EggNOG-mapper.
   - Input: Raw Prodigal protein output
   - Output: Cleaned proteins with IDs matching GFF feature identifiers
   - Process: Converts `>contigs_1_1 # 427 # 1461 # 1 # ID=1_1;...` to `>1_1 # 427 # 1461 # 1 # ID=1_1;...`

3. **EggNOG-mapper**: Provides functional annotation of predicted proteins using orthologous groups.
   - Input: Predicted protein sequences from Prodigal (with corrected IDs)
   - Output: Functional annotations including GO terms, protein families, and orthologs
   - Parameters: 16 CPU threads, bacterial taxonomic scope, all GO evidence types
   - Enhanced Output: Decorated GFF files using the `--decorate_gff` parameter to integrate functional annotations with structural predictions

## Final Output Files

The pipeline now produces standardized annotation files in the `final_annotations` directory:

- `[sample]_Prodigal.gff`: Original structural annotations from Prodigal.
- `[sample]_Prodigal_EggNOG.gff`: Complete annotations with both structural (Prodigal) and functional (EggNOG) information.


These files follow the naming convention `{sample_name}_{prediction_tool}_{annotation_tool}.{extension}` as recommended for standardized genomic analyses.

## Setup and Requirements

To recreate the conda environments used in this project:

```bash
# For Prodigal environment
conda create -n prodigal_env python=3.8 -y
conda activate prodigal_env
conda install -c bioconda prodigal=2.6.3 -y

# For EggNOG environment
conda create -n eggnog_env python=3.8 -y
conda activate eggnog_env
conda install -c conda-forge -c bioconda eggnog-mapper=2.1.12 -y
download_eggnog_data.py --data_dir /path/to/eggnog_db
```

## Running the Pipeline

To run the complete pipeline:
```bash
# Make the script executable
chmod +x run_pipeline.sh

# Run the pipeline
./run_pipeline.sh
```

The script will process all contig files in the `data/contigs/` directory, perform gene prediction with Prodigal, and then annotate the predicted proteins with EggNOG-mapper. Performance metrics and final annotation files will be generated automatically.

## Comparison with GeMoMa-based Pipeline

Unlike the GeMoMa-based pipeline, which uses reference-based gene prediction, this Prodigal pipeline:

1. **Uses ab initio prediction**: Prodigal identifies genes without requiring a reference genome
2. **Typically runs faster**: Prodigal is generally more efficient for bacterial genomes
3. **Requires ID format handling**: Special processing ensures proper integration between Prodigal and EggNOG-mapper
4. **Includes CDS length metrics**: Additional statistics about predicted gene lengths are provided

Both pipelines share the same EggNOG-based functional annotation approach and produce comparable final outputs in standardized formats.
